# E2E Testing Report

**Date**: 2026-02-21
**Scope**: Full end-to-end testing of all screens, controls, user workflows, and edge cases using Playwright MCP. Visual aesthetics assessment using frontend-design skill.

## Bug Found & Fixed

### Editor Save button triggers navigation blocker dialog

**File**: `frontend/src/hooks/useEditorAutoSave.ts`

- **Symptom**: Clicking "Save" on a new or edited post showed "You have unsaved changes. Are you sure you want to leave?" instead of saving the post.
- **Root cause**: Race condition between `markSaved()` and `navigate()` in `handleSave()`. `markSaved()` calls `setSavedState()` which is an async React state update, but `navigate()` fires synchronously before React flushes the update. The `useBlocker(isDirty)` hook still sees `isDirty === true` because `savedState` hasn't updated yet, so it blocks the navigation with a confirm dialog.
- **Fix**: Added a `navigationAllowedRef` ref. `markSaved()` sets `navigationAllowedRef.current = true`. The blocker effect checks this ref first — if set, it auto-proceeds and resets the flag, skipping the confirm dialog for intentional post-save navigation.

## Dev Setup Issue Fixed

### Login fails with 403 in Vite dev mode

**File**: `.env`

- **Symptom**: Login POST to `/api/auth/login` returns 403 Forbidden when using the Vite dev server (`localhost:5173`).
- **Root cause**: The Vite dev proxy sends `Origin: http://localhost:5173` in the browser request, but the backend's `_enforce_login_origin()` only allows `request.base_url` (which resolves to `http://localhost:8000` via the proxy). The `cors_origins` list defaults to empty.
- **Fix**: Added `CORS_ORIGINS=["http://localhost:5173"]` to `.env` so the backend allows the Vite dev server origin during development.

## All Screens Tested

| Screen | Status | Notes |
|--------|--------|-------|
| Timeline (home) | OK | Filters (labels, date range, author), OR/AND toggle, empty states, clear filters, post cards with excerpts |
| Login | OK | Error message on invalid credentials, successful auth redirects to home |
| Post View | OK | Rendered HTML, KaTeX math (inline + display), code highlighting, label links, edit/delete actions |
| Editor (new) | FIXED | Save bug fixed; title, labels combobox, draft toggle, author display, split-pane preview all work |
| Editor (edit) | OK | Loads existing content correctly, shows created/modified timestamps, file upload button |
| Search | OK | Full-text search returns ranked results with excerpts, empty state for no matches |
| Labels (list) | OK | Cards with label names, display names, post counts, parent labels, settings links |
| Labels (graph) | OK | DAG visualization with React Flow + Dagre layout, zoom controls, filter textbox |
| Label Settings | OK | Display name management, parent label selection with cycle prevention, danger zone delete |
| Label Posts | OK | DAG-aware descendant query shows all posts under a label hierarchy |
| About | OK | Renders markdown page content from `content/about.md` |
| Admin | OK | Site settings (title, description, author, timezone), page reordering with up/down arrows, password change |
| Folder Upload | OK | Markdown file + co-located assets uploaded correctly, relative image paths rewritten to absolute `/api/content/` URLs |
| File Upload | OK | Upload buttons visible only when authenticated |

## Visual Aesthetics Assessment

### Strengths

- **Typography is distinctive and well-paired**: Instrument Serif (display) + DM Sans (body) + JetBrains Mono (code) is a strong, characterful combination. The serif headings give an editorial, literary feel that suits a blogging platform.
- **Warm color palette**: Terracotta accent (`#c44b2b`) on cream (`#faf8f5`) creates a bookish, inviting aesthetic. The palette is cohesive and intentional — far from generic AI-generated design.
- **Code blocks**: Catppuccin Mocha syntax theme on dark background (`#1e1e2e`) with proper highlighting for 140+ languages looks polished.
- **KaTeX rendering**: Math displays correctly both inline and as display blocks.
- **Consistent spacing and layout**: Good use of whitespace throughout. Post cards have clear visual hierarchy with title, excerpt, metadata.
- **Animations**: Subtle `fade-in` transitions (0.4s opacity + vertical translation) add polish without being distracting. Stagger delay helpers available for sequential reveals.
- **Label graph**: The DAG visualization with React Flow is a standout feature — interactive, zoomable, with clear node styling.
- **Delete confirmation dialog**: Thoughtfully designed with two options (post only vs. post + assets) and clear descriptions.
- **Filter panel**: Well-organized with labels (including post counts), date range pickers, author filter, and OR/AND toggle.

### UI Improvement Suggestions

1. **Mobile header is broken** — The site title, action buttons (Search, Write, Admin, Logout), and nav links all compete for horizontal space on mobile (375px). The title wraps awkwardly across 3 lines while icons sit cramped on the same row. **Suggestion**: Implement a hamburger menu for mobile, hide "Write" label text on small screens (keep icon only), or truncate/collapse the site title.

2. **Login page doesn't redirect authenticated users** — If already logged in (visible in header showing Write/Admin/Logout), navigating to `/login` still shows the sign-in form instead of redirecting to the home page. **Suggestion**: Add a redirect check in LoginPage — if `user` is present in auth store, navigate to `/`.

3. **Filter label counts are inconsistent with filter results** — The filter panel shows direct-tag counts (e.g., `#cs 1`), but the actual filtering is DAG-aware and includes descendants (shows 2 results for #cs). Users expect the count badge to match the number of results they'll see. **Suggestion**: Either show DAG-aware counts in the filter, or add a note like "including subcategories".

4. **Search results date format differs from timeline** — Search results show ISO format (`2026-02-02`) while the timeline shows human-readable format (`FEB 2, 2026`). **Suggestion**: Use the same human-readable date format across all post listings for consistency.

5. **No loading indicator on folder/file upload** — When uploading a folder via the timeline page, there's no visual feedback (spinner, progress bar, or disabled state) while the upload processes before navigating to the new post. **Suggestion**: Show a loading spinner or disable the upload buttons with "Uploading..." text during the upload.

6. **Editor textarea could benefit from a toolbar** — The plain textarea works but lacks discoverability for markdown formatting. **Suggestion**: Add a minimal markdown toolbar with common shortcuts (bold, italic, heading, link, image, code block) above the textarea.

7. **Post metadata row can get cramped** — On the post view page, labels and Edit/Delete buttons share the same row. With many labels, these can overlap or get cramped on narrower desktop viewports. **Suggestion**: Consider wrapping labels onto their own line when space is tight, or moving actions to a separate row.
